#!/bin/sh -e

runtime=$PWD/runtimes/web
devtools=$PWD/devtools/web
site=$PWD/site
cli=$PWD/cli

# Node and npm versions are set using the `.nvmrc` file:
# see https://docs.netlify.com/configure-builds/manage-dependencies/#node-js-and-javascript
# see https://github.com/nvm-sh/nvm
echo "node version: $(node --version)"
echo "npm version: $(npm --version)"

npm ci
# Build runtime
npm -w wasm4-runtime run build

# Build and deploy site
rm -rf "$site/static/embed"
cp -r "$runtime/dist" "$site/static/embed"
npm -w site run build

